/* --------------------- Cake mini-game --------------------- */
function startCakeGame() {
  const overlay = document.createElement("div");
  overlay.id = "cakeOverlay";
  overlay.style.display = "flex";
  overlay.style.justifyContent = "center";
  overlay.style.alignItems = "center";
  overlay.style.flexDirection = "column";
  overlay.style.background = "rgba(255,215,232,0.9)";
  overlay.style.position = "absolute";
  overlay.style.inset = "0";
  overlay.style.zIndex = "10";
  document.body.appendChild(overlay);

  // Cake image
  const cake = document.createElement("img");
  cake.id = "cake";
  cake.src = "cake_full.png";
  cake.style.width = "120px"; // smaller cake
  cake.style.cursor = "pointer";
  overlay.appendChild(cake);

  // Cat image
  const cat = document.createElement("img");
  cat.id = "cat";
  cat.src = "cat_standing.png";
  cat.style.position = "absolute";
  cat.style.bottom = "60px";
  cat.style.left = "50%";
  cat.style.transform = "translateX(-50%)";
  cat.style.width = "200px"; // bigger cat
  overlay.appendChild(cat);

  // Knife image
  const knife = document.createElement("img");
  knife.src = "knife.png";
  knife.style.width = "60px";
  knife.style.position = "absolute";
  knife.style.display = "none"; // initially hidden
  knife.style.pointerEvents = "none"; // let it follow mouse
  knife.style.zIndex = "11";
  overlay.appendChild(knife);

  let knifePicked = false;
  let catStage = 0;
  const catSequence = [
    "cat_standing.png","cat_eating.png",
    "cat_fat1_standing.png","cat_fat1_eating.png",
    "cat_fat2_standing.png","cat_fat2_eating.png",
    "cat_fat3_standing.png","cat_fat3_eating.png",
    "cat_done.png"
  ];

  // Pick up knife by clicking anywhere on overlay
  overlay.addEventListener("click", (e) => {
    if (!knifePicked && e.target === overlay) {
      knifePicked = true;
      knife.style.display = "block";
      knife.style.left = e.clientX + "px";
      knife.style.top = e.clientY + "px";
    }
  });

  // Knife follows mouse
  overlay.addEventListener("mousemove", (e) => {
    if (knifePicked) {
      knife.style.left = e.clientX - 30 + "px"; // center knife
      knife.style.top = e.clientY - 10 + "px";
    }
  });

  // Click on cake to slice
  cake.addEventListener("click", (e) => {
    e.stopPropagation();
    if (!knifePicked) return;
    cake.src = "cake_slice.png";
  });

  // Click on cat to feed
  cat.addEventListener("click", () => {
    if (!knifePicked) return;
    catStage++;
    if (catStage >= catSequence.length) catStage = catSequence.length - 1;
    cat.src = catSequence[catStage];
    eatSound.currentTime = 0;
    eatSound.play();

    // Reset knife for next slice if not done
    if (catStage < catSequence.length - 1) {
      knifePicked = true;
      cake.src = "cake_full.png";
    } else {
      // final cat_done click to exit
      knife.style.display = "none";
      overlay.addEventListener("click", () => {
        document.body.removeChild(overlay);
      }, { once: true });
    }
  });
}
